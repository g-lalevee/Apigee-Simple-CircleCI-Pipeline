version: 2.1

jobs:
  deploy_apigee_proxy:
    docker:
      - image: maven:latest
    environment:
      API_VERSION: "googleapi"
      APIGEE_ENV: default-env
      APIGEE_ORG: bap-emea-apigee-5
    steps:
      - checkout
      - run:
          name: mvn-deploy-config
          command: |
            cd /root/project
            echo $GCP_SERVICE_ACCOUNT > sa.json
            sed -i "s/target_apigee_env/$APIGEE_ENV/g" ./EdgeConfig/edge.json
            mvn install -Pgoogleapi -Dapigee.org=$APIGEE_ORG -Denv=$APIGEE_ENV -Dsa=sa.json -Dapigee.config.file=./EdgeConfig/edge.json -Dapigee.config.options=update
  
          
workflows:
  version: 2
  dev_plan:
    jobs:
      - deploy_apigee_proxy
